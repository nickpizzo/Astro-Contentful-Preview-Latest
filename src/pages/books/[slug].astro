---
// @ts-nocheck
// src/pages/books/[slug].astro
export const prerender = false;

import { fetchBookById } from "../../api/contentful";
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";

const { slug } = Astro.params;
let book;

try {
  book = await fetchBookById(slug);
  console.log(book);
} catch (error) {
  return Astro.redirect("/404");
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{book.title}</title>
  </head>
  <body>
    <section class="px-2 sm:px-12 mb-8" transition:animate="slide">
      <h1 class="text-6xl">
        {book.title}
      </h1>
      <h2>
        written by <a href={`/author/${book.author.sys.id}`}
          >{book.author.fields.name}</a
        >
      </h2>
      <div
        class="grid grid-cols-1 gap-x-6 gap-y-10 lg:grid-cols-2 xl:gap-x-8 pt-8"
      >
        <div
          class="aspect-h-1 aspect-w-1 w-full overflow-hidden rounded-lg bg-gray-200 xl:aspect-h-8 xl:aspect-w-7"
        >
          <img
            src={book.coverImage.fields.file.url}
            alt={book.coverImage.fields.description}
            class="h-full w-full object-cover object-center group-hover:opacity-75"
          />
        </div>
        <div>
          <article
            set:html={documentToHtmlString(book.description)}
            class="leading-loose text-slate-900 text-justify"
          />
          <article class="leading-loose text-slate-900 text-justify">
            {import.meta.env.IS_PREVIEW}
          </article>
        </div>
      </div>
    </section>
  </body>
</html>
